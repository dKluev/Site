controls.initAutocomplete=function(b,a,c){$('input[name="'+a+'"]').autocomplete({source:c,minLength:0,select:function(d,e){$('input[name="'+b+'"]').val(e.item.id)}}).removeAttr("name")};controls.initSelect2=function(b,a,c){utils.loadScript("/scripts/select2.min.js?v=2",function(){var e=$('input.select2[name="'+b+'"]');var d=e.attr("value");e.select2({placeholder:" ",allowClear:true,width:"element",initSelection:function(g,f){f({text:a,id:d})},ajax:{url:c,quietMillis:100,data:function(f,g){return{term:f}},results:function(g,f){return g}}})})};controls.showLoad=function(){var a=utils.selectOrCreateById("indicator-dialog").html(controls.bigindicator);a.dialog({modal:true,width:95,minWidth:95,minHeight:95,height:95,resizable:false,title:"Загрузка",hide:"fade",show:"fade",closeOnEscape:false,open:function(b,c){$(".ui-dialog-titlebar-close",$(this).parent()).hide()}})};controls.hideLoad=function(){$("#indicator-dialog").dialog("close")};controls.getParentUIDialog=function(a){return a.parents("[id^='ui-dialog']:first")};controls.openUIDialog=function(a,b){var d="ui-dialog"+a.replace(/[\/?&=]/g,"-");var c=!b;if(c){b=utils.selectOrCreateById(d).css({display:"none"});maxWidth=screen.width-200;b.empty().css({maxWidth:maxWidth})}controls.showLoad();b.load(utils.addRandomPostfix(a),function(){controls.hideLoad();var f=$(this).find("h1");var i=f.html();f.remove();if(!c){$("form.ajax-form",b).prepend(h.tag("div",{"class":"form-info ui-state-highlight ui-corner-all",style:"margin:5px 0",text:"Операция выполнена успешно"}))}function e(){$("table.resize-in-dialog",b).each(function(){$(this).setGridWidth(b.width())})}var g=$(this).dialog({modal:true,width:"auto",height:"auto",hide:"fade",show:"fade",closeOnEscape:false,close:function(m,n){var k=b.data("refreshCallback");var l=b.data("needRefresh");if(l&&k){k()}b.dialog("destroy").remove()},open:function(k,l){e()},resizeStop:function(k,l){e()}});var j=h.tag("div").append(h.tag("a",{href:a}).append(h.tag("span",{style:"float:left;","class":"ui-icon ui-icon-extlink"}))).html()+i;g.parent().find(".ui-dialog-title").html(j)});return b};utils.allLoadScripts=[];utils.loadScript=function(f,g){if(!$.isArray(f)){f=[f]}var b=0;function e(i,j){if(j!==true){utils.allLoadScripts.push(d)}b++;if(b==f.length){g()}}var a=f.length;var c=0;for(c=0;c<a;c++){var d=f[c];if($.inArray(d,utils.allLoadScripts)>=0){e(d,true)}else{(function(i){$.getScript(d,function(){e(i)})})(d)}}};utils.postShowLoad=function(a,b,c){controls.showLoad();if(typeof(b)=="function"){c=b;b=null}$.post(a,b,function(d){controls.hideLoad();if(c){c(d)}})};controls.initUITabs=function(a){$("div.ui-tab-control",a).tabs()};$(function(){function a(){$(document).on("click","form.ajax-form button",function(){var b=$(this).parent("form.ajax-form");$("div.form-info",b).remove();$("div.form-error",b).remove();$(".input-validation-error").removeClass("input-validation-error");if(window.tinyMCE){tinyMCE.triggerSave(true,true)}utils.postShowLoad(b.attr("action"),b.serialize(),function(e){if(e.Errors){b.prepend(h.tag("div",{"class":"form-error ui-state-error ui-corner-all"}).html(e.Errors));$.each(e.Names,function(g,f){$("input[name='"+f+"']",b).addClass("input-validation-error")})}else{if(e.Url){var c=controls.getParentUIDialog(b);c.data("needRefresh",true);if(c.length){controls.openUIDialog(e.Url,c)}else{window.location=e.Url}}else{if(e.Redirect){window.location=e.Redirect}else{if(e=="ok"||e.message){var d=e.message||"Операция выполнена успешно";controls.getParentUIDialog(b).data("needRefresh",true);b.prepend(h.tag("div",{"class":"form-info ui-state-highlight ui-corner-all",style:"margin:5px 0",text:d}))}else{if(b.hasClass("content-load-form")){$("div."+b.attr("id")).html(e)}}}}}});return false})}a()});var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());